<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>CouchApps No Longer Work</title>
  <meta charset="UTF-8" />
  <meta name="theme-color" content="#354F52">
  <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/latest/ui-shell.min.js"></script>
  <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/latest/button.min.js"></script>
  <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/latest/tag.min.js"></script>
  <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/latest/notification.min.js"></script>
  

  <link rel="icon" href="https://blog.cloudant.com/favicon.png">

  

<link rel="stylesheet"
href="https://1.www.s81c.com/common/carbon-for-ibm-dotcom/tag/v1/canary/plex.css"/>
<link rel="stylesheet"
href="https://1.www.s81c.com/common/carbon-for-ibm-dotcom/tag/v1/canary/grid.css"/>

<style>
       
bx-header~bx-side-nav{margin-top:3rem;height:calc(100% - 3rem)}
.bx-hugo-carbon--ui-shell-content{
  will-change:margin-left;transition:margin-left .11s cubic-bezier(0.2, 0, 1, 0.9);
}
#main-content {margin-top: 3rem;}

@media(min-width: 66rem){

  #main-content{margin-left:16rem}

}
html {margin:0; font-family: "IBM Plex Sans", "Helvetica Neue", Arial, sans-serif;}
bx-side-nav {top:3rem; display: block; overflow: scroll;}
bx-header {display:flex; background: #000;color:#fff;height: 3rem;width:100%}
</style>


<link rel="stylesheet" type="text/css" href="https://blog.cloudant.com/css/main.css?i=000" media="all">



 




 <meta name="generator" content="Hugo 0.115.0">

  
    
    <meta property="og:type" content="article" />
    <meta property="og:title" content="CouchApps No Longer Work">
    <meta property="og:url" content="https://blog.cloudant.com/2021/10/20/CouchApps-no-longer-work.html" />
    <meta property="og:description" content="A new HTTP header makes CouchApps inoperable." />
    <meta property="article:published_time" content="2021-10-20 00:00:00 &#43;0000 UTC" />
    <meta property="og:site_name" content="Cloudant blog" />
    <meta property="og:image" content="/img/jose-fontano-pZld9PiPDno-unsplash.jpg" />

    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="Cloudant blog" />
    <meta name="twitter:title" content="CouchApps No Longer Work" />
    <meta name="twitter:description" content="A new HTTP header makes CouchApps inoperable." />
    <meta name="twitter:creator" content="Cloudant blog" />

    
    <meta itemprop="name" content="CouchApps No Longer Work">
    <meta itemprop="description" content="A new HTTP header makes CouchApps inoperable.">
    <meta itemprop="image" content="/img/jose-fontano-pZld9PiPDno-unsplash.jpg">
  




  
  <style>
@media (min-width: 66rem) {
.container .bx--grid {
  padding-left: calc(25% + 1.5rem);
  padding-right: 2rem;
}
}
    h3 {
      margin-bottom: 1rem;
    }
  </style>
  </head>
<body class="">
     
<bx-skip-to-content href="#main-content" role="navigation" aria-label="Skip to main content"></bx-skip-to-content>
<bx-header aria-label=" Cloudant blog" role="banner">
  <bx-header-name href="https://blog.cloudant.com/" prefix=""> Cloudant blog</bx-header-name>
  <bx-header-nav menu-bar-label=" Cloudant blog" role="navigation">
    
        
          
            <bx-header-nav-item active="" href="https://blog.cloudant.com/">Home</bx-header-nav-item>
          
        
          
            <bx-header-nav-item active="" href="https://blog.cloudant.com/search.html">Search</bx-header-nav-item>
          
        
    
  </bx-header-nav>
</bx-header>
<div style="height:50px"></div>
<main class="bx--content bx-hugo-carbon--ui-shell-content">
  <div class="bx--grid">
    <div class="bx--row">


<div class="bx--col-sm-12 bx--col-md-12 bx--col-lg-12  bx--col-xlg-12 bx--col-max-12">
  <h1 class="p-name">CouchApps No Longer Work</h1>
  
  <div class="postmeta">Oct 20, 2021 | Glynn Bird | 

  
  <bx-tag>CouchApp</bx-tag>
  
  <bx-tag>Static</bx-tag>
  


  </div>
  
  <p>Cloudant mainly stores JSON documents in collections called <em>databases</em>, but Cloudant also has the ability to store <a href="https://cloud.ibm.com/docs/Cloudant?topic=Cloudant-attachments">attachments</a> in Cloudant documents. An attachment is a binary blob of data with a file name and mime type. It could be a PDF, a JPG or a Word document.</p>
<p>Some users employed attachments to store HTML, CSS, JavaScript files and other assets in the database so that it could be used as a webserver - applications following this pattern were known as <a href="https://github.com/couchapp/couchapp">CouchApps</a>. CouchApps deployed the website and the database <em>in the same web domain</em>, allowing client-side JavaScript to make calls back to the server to add, update and delete documents without having to worry about <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">cross-origin security restrictions</a>.</p>
<p><img src="https://blog.cloudant.com/img/jose-fontano-pZld9PiPDno-unsplash.jpg" alt="locked"></p>
<blockquote>
<p>Photo by <a href="https://unsplash.com/photos/pZld9PiPDno">Jose Fontano on Unsplash</a></p>
</blockquote>
<h2 id="cloudant-no-longer-permits-couchapp-scripts"style="display:inline">Cloudant no longer permits CouchApp scripts</h2><a class="stealth" href="#cloudant-no-longer-permits-couchapp-scripts">ðŸ”—</a><br>
<p>As of October 2021, CouchApps using JavaScript will become inoperable on Cloudant. Fetched attachments will be served out with an additional header: <code>Content-Security-Policy: sandbox</code>. This header instructs the browser to prevent script execution on such attachments, so any JavaScript (whether in <code>.js</code> files or in <code>&lt;script&gt;</code> tags) will be barred from execution on the client machine.</p>
<p>Only Javascript-free CouchApps will continue to operate.</p>
<p>The reason for this change is to close a <a href="https://docs.couchdb.org/en/stable/cve/2021-38295.html">security loophole</a> which could lead to privilege escalation and malicious data access.</p>
<h2 id="regular-attachments-will-continue-to-work"style="display:inline">Regular attachments will continue to work</h2><a class="stealth" href="#regular-attachments-will-continue-to-work">ðŸ”—</a><br>
<p>Regular document attachments will continue to work as normal, the only difference being the addition of the <code>Content-Security-Policy</code> header on attachment retrieval which should not affect normal operation.</p>
<h2 id="alternatives-to-couchapps"style="display:inline">Alternatives to CouchApps</h2><a class="stealth" href="#alternatives-to-couchapps">ðŸ”—</a><br>
<p>Static websites have become very popular in recent years and there many better places for hosting static content than in a database:</p>
<ul>
<li><a href="https://pages.github.com/">GitHub Pages</a> allows files in a git repository to be served out on the web, with custom domain name an HTTPS support for free.</li>
<li><a href="https://www.netlify.com/">Netlify</a> offers a similar git-based workflow to GitHub Pages but adds the ability to add serverless functions into the mix.</li>
<li>or, <a href="https://www.ibm.com/uk-en/cloud/hosting/web-hosting">any number of website hosting offerrings</a>.</li>
</ul>
<p>Any of the above solutions will mean that the website and database server will reside on <em>different domain names</em> and by default, a web page may only access resources on the domain it was served out from. This will mean that web requests originating from web page&rsquo;s JavaScript, targeting a Cloudant service would not be permitted (by the web browser).</p>
<p>Cloudant can be configured to permit cross-domain requests by enabling CORS <a href="https://cloud.ibm.com/docs/Cloudant?topic=Cloudant-cors#dashboard">in the Cloudant Dashboard</a>: you may choose to allow requests from any domain, or to a list of specified domains.</p>
<p>The combination of a static hosting service and Cloudant with CORS enabled, should allow CouchApp-like functionality to be reproduced.</p>

</div>
</div>
</div>
</main>



</body>
</html>

